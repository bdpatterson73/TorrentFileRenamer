<UserControl x:Class="TorrentFileRenamer.WPF.Views.Controls.MovieFileCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:models="clr-namespace:TorrentFileRenamer.WPF.Models"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance Type=models:MovieFileModel}"
             d:DesignHeight="450" d:DesignWidth="800">

    <Border Style="{StaticResource FileCard}">
        <Border.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard Storyboard="{StaticResource CardEntranceAnimation}" />
            </EventTrigger>
        </Border.Triggers>

        <Grid>
            <!-- Status Accent Bar (4px colored border on left) -->
            <Border Grid.RowSpan="10"
                    Style="{StaticResource StatusBorder}"
                    Background="{Binding Status, Converter={StaticResource StatusToBrushConverter}}" />

            <!-- Card Content with padding from accent bar -->
            <Grid Margin="20,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" /> <!-- Header -->
                    <RowDefinition Height="8" />    <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Confidence indicator -->
                    <RowDefinition Height="8" />    <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Original filename section -->
                    <RowDefinition Height="8" />    <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- New filename section -->
                    <RowDefinition Height="12" />   <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Paths section -->
                    <RowDefinition Height="12" />   <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Metadata footer -->
                    <RowDefinition Height="12" />   <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Error section -->
                    <RowDefinition Height="12" />   <!-- Spacing -->
                    <RowDefinition Height="Auto" /> <!-- Action buttons -->
                </Grid.RowDefinitions>

                <!-- Header Row: Status Icon + Movie Name/Year + Confidence + Status Badge -->
                <Grid Grid.Row="0" Margin="16,16,16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" /> <!-- Status Icon -->
                        <ColumnDefinition Width="*" />    <!-- Movie Name/Year -->
                        <ColumnDefinition Width="Auto" /> <!-- Confidence Badge -->
                        <ColumnDefinition Width="8" />    <!-- Spacer -->
                        <ColumnDefinition Width="Auto" /> <!-- Status Badge -->
                    </Grid.ColumnDefinitions>

                    <!-- Status Icon -->
                    <TextBlock Grid.Column="0"
                               Text="{Binding Status, Converter={StaticResource StatusToIconConverter}}"
                               FontSize="24"
                               FontFamily="Segoe MDL2 Assets"
                               VerticalAlignment="Center"
                               Margin="0,0,12,0"
                               Foreground="{Binding Status, Converter={StaticResource StatusToBrushConverter}}" />

                    <!-- Movie Name and Year -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Style="{StaticResource CardTitle}"
                                   Text="{Binding MovieName}"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{Binding MovieName}" />
                        <TextBlock Style="{StaticResource CardSubtitle}"
                                   Text="{Binding MovieYear}"
                                   Margin="0,4,0,0"
                                   Visibility="{Binding MovieYear, Converter={StaticResource StringToVisibilityConverter}}" />
                    </StackPanel>

                    <!-- Confidence Badge -->
                    <Border Grid.Column="2"
                            VerticalAlignment="Top"
                            Padding="8,4"
                            CornerRadius="12"
                            Margin="8,0,0,0">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                        <Setter Property="Background" Value="#E8F5E9" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                        <Setter Property="Background" Value="#FFF9E6" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                        <Setter Property="Background" Value="#FFEBEE" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock FontSize="11"
                                       FontWeight="Medium"
                                       VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                                <Setter Property="Foreground" Value="#2E7D32" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                                <Setter Property="Foreground" Value="#F57C00" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                                <Setter Property="Foreground" Value="#C62828" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                                <Run Text="{Binding Confidence, Mode=OneWay}" />
                                <Run Text="% " />
                                <Run Text="{Binding ConfidenceLevel, Mode=OneWay}" />
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Status Badge -->
                    <Border Grid.Column="4"
                            Style="{StaticResource StatusBadge}"
                            VerticalAlignment="Top"
                            Background="{Binding Status, Converter={StaticResource StatusToBrushConverter}}">
                        <TextBlock Style="{StaticResource StatusBadgeText}"
                                   Text="{Binding StatusText}" />
                    </Border>
                </Grid>

                <!-- Confidence Indicator Bar -->
                <Border Grid.Row="2"
                        Margin="16,0"
                        Padding="12,8"
                        CornerRadius="6">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                    <Setter Property="Background" Value="#E8F5E9" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                    <Setter Property="Background" Value="#FFF9E6" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                    <Setter Property="Background" Value="#FFEBEE" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ProgressBar Grid.Column="0"
                                     Height="6"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="{Binding Confidence}"
                                     VerticalAlignment="Center">
                            <ProgressBar.Style>
                                <Style TargetType="ProgressBar">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                            <Setter Property="Foreground" Value="#4CAF50" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                            <Setter Property="Foreground" Value="#FF9800" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                            <Setter Property="Foreground" Value="#F44336" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ProgressBar.Style>
                        </ProgressBar>

                        <TextBlock Grid.Column="1"
                                   VerticalAlignment="Center"
                                   Margin="12,0,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource CardCaption}">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="High">
                                            <Setter Property="Foreground" Value="#2E7D32" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Medium">
                                            <Setter Property="Foreground" Value="#F57C00" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding ConfidenceLevel}" Value="Low">
                                            <Setter Property="Foreground" Value="#C62828" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                            <Run Text="Match Confidence: " />
                            <Run Text="{Binding ConfidenceLevel, Mode=OneWay}" FontWeight="SemiBold" />
                        </TextBlock>
                    </Grid>
                </Border>

                <!-- Original Filename Section -->
                <Border Grid.Row="4"
                        Margin="16,0"
                        Padding="12"
                        Background="#F5F5F5"
                        CornerRadius="6">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="4" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Style="{StaticResource CardCaption}"
                                   Text="ORIGINAL FILENAME"
                                   Foreground="#9E9E9E" />

                        <TextBlock Grid.Row="2"
                                   Style="{StaticResource CardBody}"
                                   Text="{Binding FileName}"
                                   TextWrapping="Wrap"
                                   TextTrimming="CharacterEllipsis"
                                   MaxHeight="60"
                                   ToolTip="{Binding FileName}" />
                    </Grid>
                </Border>

                <!-- New Filename Section -->
                <Border Grid.Row="6"
                        Margin="16,0"
                        Padding="12"
                        Background="#E8F5E9"
                        CornerRadius="6">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="4" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Style="{StaticResource CardCaption}"
                                   Text="NEW FILENAME"
                                   Foreground="#2E7D32" />

                        <TextBlock Grid.Row="2"
                                   Style="{StaticResource CardBody}"
                                   Text="{Binding NewFileName}"
                                   FontWeight="Medium"
                                   TextWrapping="Wrap"
                                   TextTrimming="CharacterEllipsis"
                                   MaxHeight="60"
                                   ToolTip="{Binding NewFileName}" />
                    </Grid>
                </Border>

                <!-- Source and Destination Paths -->
                <Grid Grid.Row="8" Margin="16,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="8" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Source Path -->
                    <StackPanel Grid.Row="0">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="&#xE8B7;" FontSize="14" FontFamily="Segoe MDL2 Assets"
                                       VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBlock Style="{StaticResource CardCaption}"
                                       Text="SOURCE PATH"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Style="{StaticResource CardMetadata}"
                                   Text="{Binding SourcePath}"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{Binding SourcePath}" />
                    </StackPanel>

                    <!-- Destination Path -->
                    <StackPanel Grid.Row="2">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="&#xE8B7;" FontSize="14" FontFamily="Segoe MDL2 Assets"
                                       VerticalAlignment="Center" Margin="0,0,6,0" />
                            <TextBlock Style="{StaticResource CardCaption}"
                                       Text="DESTINATION PATH"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Style="{StaticResource CardMetadata}"
                                   Text="{Binding DestinationPath}"
                                   TextTrimming="CharacterEllipsis"
                                   ToolTip="{Binding DestinationPath}" />
                    </StackPanel>
                </Grid>

                <!-- Metadata Footer -->
                <Border Grid.Row="10"
                        Margin="16,0"
                        Padding="12,8"
                        Background="#FAFAFA"
                        CornerRadius="6">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- File Type Info -->
                        <TextBlock Grid.Column="0"
                                   Style="{StaticResource CardMetadata}"
                                   Text="Movie File"
                                   VerticalAlignment="Center" />

                        <!-- File Size and Extension -->
                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <TextBlock Style="{StaticResource CardMetadata}"
                                       Text="{Binding FileSize, Converter={StaticResource FileSizeConverter}}"
                                       Margin="0,0,12,0" />
                            <TextBlock Style="{StaticResource CardMetadata}"
                                       Text="{Binding Extension}"
                                       FontWeight="Medium" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Error Message Section (only visible when error exists) -->
                <Border Grid.Row="12"
                        Margin="16,0"
                        Padding="12"
                        Background="#FFEBEE"
                        CornerRadius="6"
                        Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="&#xE7BA;"
                                   FontSize="18"
                                   FontFamily="Segoe MDL2 Assets"
                                   VerticalAlignment="Top"
                                   Margin="0,0,8,0"
                                   Foreground="#C62828" />

                        <StackPanel Grid.Column="1">
                            <TextBlock Style="{StaticResource CardCaption}"
                                       Text="ERROR"
                                       Foreground="#C62828"
                                       Margin="0,0,0,4" />
                            <TextBlock Style="{StaticResource CardBody}"
                                       Text="{Binding ErrorMessage}"
                                       TextWrapping="Wrap"
                                       Foreground="#D32F2F" />
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Action Buttons Footer -->
                <Border Grid.Row="14"
                        Margin="16,0,16,16"
                        Padding="12,8"
                        Background="#F5F5F5"
                        CornerRadius="6">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Padding="12,6"
                                Style="{StaticResource SecondaryButton}"
                                Margin="0,0,8,0"
                                Command="{Binding DataContext.ViewDetailsCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                CommandParameter="{Binding}"
                                ToolTip="View Details">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE946;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Details" />
                            </StackPanel>
                        </Button>

                        <Button Padding="12,6"
                                Style="{StaticResource SecondaryButton}"
                                Margin="0,0,8,0"
                                Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                CommandParameter="{Binding}"
                                ToolTip="Open Folder">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE8B7;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Folder" />
                            </StackPanel>
                        </Button>

                        <Button Padding="12,6"
                                Style="{StaticResource SecondaryButton}"
                                Margin="0,0,8,0"
                                Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                CommandParameter="{Binding}"
                                ToolTip="Remove">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Remove" />
                            </StackPanel>
                        </Button>

                        <Button Padding="12,6"
                                Style="{StaticResource PrimaryButton}"
                                Command="{Binding DataContext.RetryCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                CommandParameter="{Binding}"
                                Visibility="{Binding Status, Converter={StaticResource StatusToRetryVisibilityConverter}}"
                                ToolTip="Retry">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="&#xE72C;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                           Margin="0,0,6,0" />
                                <TextBlock Text="Retry" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>
    </Border>
</UserControl>