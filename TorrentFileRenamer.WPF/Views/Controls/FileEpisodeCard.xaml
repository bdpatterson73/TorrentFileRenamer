<UserControl x:Class="TorrentFileRenamer.WPF.Views.Controls.FileEpisodeCard"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
     xmlns:models="clr-namespace:TorrentFileRenamer.WPF.Models"
  mc:Ignorable="d" 
         d:DataContext="{d:DesignInstance Type=models:FileEpisodeModel}"
        d:DesignHeight="450" d:DesignWidth="800">
    
    <Border Style="{StaticResource FileCard}">
        <Border.Triggers>
            <EventTrigger RoutedEvent="Loaded">
    <BeginStoryboard Storyboard="{StaticResource CardEntranceAnimation}"/>
   </EventTrigger>
        </Border.Triggers>

        <Grid>
       <!-- Status Accent Bar (4px colored border on left) -->
 <Border Grid.RowSpan="10" 
  Style="{StaticResource StatusBorder}"
     Background="{Binding Status, Converter={StaticResource StatusToBrushConverter}}"/>

   <!-- Card Content with padding from accent bar -->
            <Grid Margin="20,0,0,0">
  <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/> <!-- Header -->
         <RowDefinition Height="8"/>  <!-- Spacing -->
     <RowDefinition Height="Auto"/> <!-- Multi-episode indicator -->
        <RowDefinition Height="8"/>    <!-- Spacing -->
 <RowDefinition Height="Auto"/> <!-- Original filename section -->
          <RowDefinition Height="8"/>    <!-- Spacing -->
   <RowDefinition Height="Auto"/> <!-- New filename section -->
          <RowDefinition Height="12"/>   <!-- Spacing -->
 <RowDefinition Height="Auto"/> <!-- Paths section -->
        <RowDefinition Height="12"/>   <!-- Spacing -->
          <RowDefinition Height="Auto"/> <!-- Metadata footer -->
  <RowDefinition Height="12"/>   <!-- Spacing -->
       <RowDefinition Height="Auto"/> <!-- Error section -->
        <RowDefinition Height="12"/>   <!-- Spacing -->
     <RowDefinition Height="Auto"/> <!-- Action buttons -->
      </Grid.RowDefinitions>

                <!-- Header Row: Status Icon + Show/Episode + Status Badge -->
  <Grid Grid.Row="0" Margin="16,16,16,0">
            <Grid.ColumnDefinitions>
<ColumnDefinition Width="Auto"/> <!-- Status Icon -->
              <ColumnDefinition Width="*"/>    <!-- Show Name/Episode -->
        <ColumnDefinition Width="Auto"/> <!-- Status Badge -->
           </Grid.ColumnDefinitions>

              <!-- Status Icon -->
 <TextBlock Grid.Column="0"
           Text="{Binding Status, Converter={StaticResource StatusToIconConverter}}"
   FontSize="24"
     VerticalAlignment="Center"
     Margin="0,0,12,0"
      Foreground="{Binding Status, Converter={StaticResource StatusToBrushConverter}}"/>

          <!-- Show Name and Episode Info -->
        <StackPanel Grid.Column="1" VerticalAlignment="Center">
             <TextBlock Style="{StaticResource CardTitle}"
       Text="{Binding ShowName}"
    TextTrimming="CharacterEllipsis"
          ToolTip="{Binding ShowName}"/>
   <TextBlock Style="{StaticResource CardSubtitle}"
       Margin="0,4,0,0">
       <Run Text="Season"/>
     <Run Text="{Binding SeasonNumber, Mode=OneWay}"/>
      <Run Text=" | Episode"/>
    <Run Text="{Binding EpisodeNumbers, Mode=OneWay}"/>
           </TextBlock>
    </StackPanel>

           <!-- Status Badge -->
          <Border Grid.Column="2"
         Style="{StaticResource StatusBadge}"
              VerticalAlignment="Top"
            Background="{Binding Status, Converter={StaticResource StatusToBrushConverter}}">
       <TextBlock Style="{StaticResource StatusBadgeText}"
 Text="{Binding StatusText}"/>
          </Border>
    </Grid>

         <!-- Multi-Episode Indicator -->
          <Border Grid.Row="2" 
 Margin="16,0"
        Padding="12,8"
        Background="{StaticResource CardWarningSection}"
          CornerRadius="6"
  Visibility="{Binding IsMultiEpisode, Converter={StaticResource BoolToVisibilityConverter}}">
        <StackPanel Orientation="Horizontal">
        <TextBlock Text="&#x1F4D1;" 
  FontSize="16" 
        VerticalAlignment="Center"
    Margin="0,0,8,0"/>
 <TextBlock Style="{StaticResource CardBody}"
 VerticalAlignment="Center">
    <Run Text="Multi-Episode File | Episodes:"/>
 <Run Text="{Binding EpisodeNumbers, Mode=OneWay}" FontWeight="SemiBold"/>
 </TextBlock>
    </StackPanel>
</Border>

            <!-- Original Filename Section -->
          <Border Grid.Row="4" 
       Margin="16,0"
   Padding="12"
      Background="{StaticResource CardSectionBackground}"
      CornerRadius="6">
      <Grid>
               <Grid.RowDefinitions>
         <RowDefinition Height="Auto"/>
         <RowDefinition Height="4"/>
  <RowDefinition Height="Auto"/>
           </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
           Style="{StaticResource CardCaption}"
        Text="ORIGINAL FILENAME"
           Foreground="#9E9E9E"/>
      
     <TextBlock Grid.Row="2"
     Style="{StaticResource CardBody}"
          Text="{Binding CoreEpisode.FileName}"
     TextWrapping="Wrap"
    TextTrimming="CharacterEllipsis"
     MaxHeight="60"
 ToolTip="{Binding CoreEpisode.FileName}"/>
     </Grid>
 </Border>

           <!-- New Filename Section -->
                <Border Grid.Row="6" 
   Margin="16,0"
      Padding="12"
              Background="{StaticResource CardSuccessSection}"
      CornerRadius="6">
            <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
  <RowDefinition Height="4"/>
     <RowDefinition Height="Auto"/>
     </Grid.RowDefinitions>

   <TextBlock Grid.Row="0"
       Style="{StaticResource CardCaption}"
   Text="NEW FILENAME"
  Foreground="#2E7D32"/>
    
          <TextBlock Grid.Row="2"
      Style="{StaticResource CardBody}"
                  Text="{Binding NewFileName}"
   FontWeight="Medium"
         TextWrapping="Wrap"
   TextTrimming="CharacterEllipsis"
          MaxHeight="60"
          ToolTip="{Binding NewFileName}"/>
  </Grid>
       </Border>

         <!-- Source and Destination Paths -->
  <Grid Grid.Row="8" Margin="16,0">
      <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
      <RowDefinition Height="8"/>
          <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

 <!-- Source Path -->
          <StackPanel Grid.Row="0">
    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
    <TextBlock Text="&#x1F4C1;" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
      <TextBlock Style="{StaticResource CardCaption}"
     Text="SOURCE PATH"
      VerticalAlignment="Center"/>
           </StackPanel>
          <TextBlock Style="{StaticResource CardMetadata}"
    Text="{Binding SourcePath}"
     TextTrimming="CharacterEllipsis"
      ToolTip="{Binding SourcePath}"/>
    </StackPanel>

         <!-- Destination Path -->
       <StackPanel Grid.Row="2">
      <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
       <TextBlock Text="&#x1F4C2;" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
  <TextBlock Style="{StaticResource CardCaption}"
   Text="DESTINATION PATH"
         VerticalAlignment="Center"/>
   </StackPanel>
      <TextBlock Style="{StaticResource CardMetadata}"
      Text="{Binding DestinationPath}"
     TextTrimming="CharacterEllipsis"
     ToolTip="{Binding DestinationPath}"/>
    </StackPanel>
        </Grid>

             <!-- Metadata Footer -->
     <Border Grid.Row="10" 
          Margin="16,0"
                Padding="12,8"
            Background="#FAFAFA"
  CornerRadius="6">
        <Grid>
     <Grid.ColumnDefinitions>
       <ColumnDefinition Width="*"/>
         <ColumnDefinition Width="Auto"/>
               </Grid.ColumnDefinitions>

              <!-- Plex Validation -->
         <TextBlock Grid.Column="0"
              Style="{StaticResource CardMetadata}"
  Text="{Binding PlexValidation}"
             VerticalAlignment="Center"
     TextTrimming="CharacterEllipsis"
        ToolTip="{Binding PlexValidation}"/>

   <!-- File Info -->
       <StackPanel Grid.Column="1" 
    Orientation="Horizontal" 
                VerticalAlignment="Center">
          <TextBlock Style="{StaticResource CardMetadata}"
    Text="{Binding CoreEpisode.FileSize, Converter={StaticResource FileSizeConverter}}"
            Margin="0,0,12,0"/>
  <TextBlock Style="{StaticResource CardMetadata}"
          Text="{Binding Extension}"
  FontWeight="Medium"/>
              </StackPanel>
     </Grid>
          </Border>

    <!-- Error Message Section (only visible when error exists) -->
 <Border Grid.Row="12" 
    Margin="16,0"
    Padding="12"
    Background="{StaticResource CardErrorSection}"
 CornerRadius="6"
    Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
<Grid>
   <Grid.ColumnDefinitions>
   <ColumnDefinition Width="Auto"/>
  <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

       <TextBlock Grid.Column="0"
     Text="&#x26A0;&#xFE0F;"
     FontSize="18"
        VerticalAlignment="Top"
 Margin="0,0,8,0"/>
 
   <StackPanel Grid.Column="1">
       <TextBlock Style="{StaticResource CardCaption}"
    Text="ERROR"
     Foreground="#C62828"
           Margin="0,0,0,4"/>
    <TextBlock Style="{StaticResource CardBody}"
        Text="{Binding ErrorMessage}"
          TextWrapping="Wrap"
Foreground="#D32F2F"/>
       </StackPanel>
    </Grid>
        </Border>

     <!-- Action Buttons Footer -->
       <Border Grid.Row="14" 
   Margin="16,0,16,16"
     Padding="12,8"
        Background="#F5F5F5"
      CornerRadius="6">
  <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
  <Button Content="View Details"
           Style="{StaticResource SecondaryButton}"
       Padding="12,6"
        Margin="0,0,8,0"
      Command="{Binding DataContext.ViewDetailsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
        CommandParameter="{Binding}"/>
 
             <Button Content="Open Folder"
       Style="{StaticResource SecondaryButton}"
          Padding="12,6"
                   Margin="0,0,8,0"
       Command="{Binding DataContext.OpenFolderCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
   CommandParameter="{Binding}"/>
      
       <Button Content="Remove"
         Style="{StaticResource SecondaryButton}"
         Padding="12,6"
             Margin="0,0,8,0"
    Command="{Binding DataContext.RemoveSelectedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
       CommandParameter="{Binding}"/>
    
  <Button Content="Retry"
           Style="{StaticResource PrimaryButton}"
    Padding="12,6"
           Command="{Binding DataContext.RetryCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
               CommandParameter="{Binding}"
 Visibility="{Binding Status, Converter={StaticResource StatusToRetryVisibilityConverter}}"/>
          </StackPanel>
          </Border>
        </Grid>
        </Grid>
    </Border>
</UserControl>
