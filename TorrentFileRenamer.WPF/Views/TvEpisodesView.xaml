<UserControl x:Class="TorrentFileRenamer.WPF.Views.TvEpisodesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
  xmlns:vm="clr-namespace:TorrentFileRenamer.WPF.ViewModels"
  xmlns:models="clr-namespace:TorrentFileRenamer.WPF.Models"
   xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
 xmlns:behaviors="clr-namespace:TorrentFileRenamer.WPF.Behaviors"
 xmlns:controls="clr-namespace:TorrentFileRenamer.WPF.Views.Controls"
  mc:Ignorable="d" 
    d:DesignHeight="450" d:DesignWidth="800"
 d:DataContext="{d:DesignInstance Type=vm:TvEpisodesViewModel}">
<UserControl.Resources>
 <!-- Status to Color Converter -->
     <SolidColorBrush x:Key="PendingBrush" Color="#FFE8F4F8"/>
  <SolidColorBrush x:Key="ProcessingBrush" Color="#FFFEF9E7"/>
        <SolidColorBrush x:Key="CompletedBrush" Color="#FFE8F5E9"/>
    <SolidColorBrush x:Key="FailedBrush" Color="#FFFDECEA"/>
     <SolidColorBrush x:Key="UnparsedBrush" Color="#FFF5F5F5"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
<RowDefinition Height="Auto"/> <!-- Toolbar -->
            <RowDefinition Height="Auto"/> <!-- StatsWidget (Phase 6) -->
 <RowDefinition Height="Auto"/> <!-- View controls -->
       <RowDefinition Height="*"/>    <!-- Content with Filter Panel -->
 <RowDefinition Height="Auto"/> <!-- Status bar -->
     </Grid.RowDefinitions>

        <!-- Toolbar -->
     <ToolBar Grid.Row="0" Style="{StaticResource ModernToolBar}">
   <Button Content="Scan" 
    Command="{Binding ScanCommand}"
        Style="{StaticResource PrimaryButton}" 
    ToolTip="Scan for TV episodes (Ctrl+S)"/>
   <Button Content="Process" 
    Command="{Binding ProcessCommand}"
     Style="{StaticResource PrimaryButton}"
       ToolTip="Process scanned episodes (Ctrl+P)"/>
   <Separator/>
        <Button Content="Remove Selected" 
        Command="{Binding RemoveSelectedCommand}"
      CommandParameter="{Binding SelectedItem, ElementName=EpisodesDataGrid}"
       Style="{StaticResource SecondaryButton}"
   ToolTip="Remove selected episode (Delete)"/>
   <Button Content="Clear All" 
    Command="{Binding ClearAllCommand}"
    Style="{StaticResource SecondaryButton}"
   ToolTip="Clear all episodes (Ctrl+D)"/>
       <Button Content="Remove Unparsed" 
    Command="{Binding RemoveUnparsedCommand}"
    Style="{StaticResource SecondaryButton}"
        ToolTip="Remove all unparsed files"/>
   </ToolBar>

      <!-- Phase 6: Statistics Widget -->
        <controls:StatsWidget Grid.Row="1"
   DataContext="{Binding StatsViewModel}"/>

        <!-- View Controls: View Mode Selector + Search Box -->
        <Border Grid.Row="2" 
      Background="#F5F5F5" 
 Padding="16,12"
     BorderBrush="#E0E0E0"
  BorderThickness="0,1">
  <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/> <!-- View mode selector -->
     <ColumnDefinition Width="16"/>   <!-- Spacer -->
     <ColumnDefinition Width="Auto"/> <!-- Status filter -->
 <ColumnDefinition Width="*"/>    <!-- Spacer -->
  <ColumnDefinition Width="Auto"/> <!-- Search box -->
     </Grid.ColumnDefinitions>

           <!-- View Mode Selector -->
       <StackPanel Grid.Column="0" Orientation="Horizontal">
    <TextBlock Text="View:" 
     VerticalAlignment="Center"
    FontWeight="Medium"
     Margin="0,0,12,0"/>
    
 <RadioButton Content="Cards"
    Style="{StaticResource ViewToggleButton}"
   IsChecked="{Binding IsCardViewSelected}"
     Margin="0,0,8,0"/>
       
  <RadioButton Content="Compact"
 Style="{StaticResource ViewToggleButton}"
      IsChecked="{Binding IsCompactViewSelected}"
     Margin="0,0,8,0"/>
  
        <RadioButton Content="Grid"
        Style="{StaticResource ViewToggleButton}"
   IsChecked="{Binding IsGridViewSelected}"/>
  </StackPanel>

  <!-- Status Filter -->
  <StackPanel Grid.Column="2" Orientation="Horizontal">
    <TextBlock Text="Status:" 
     VerticalAlignment="Center"
 FontWeight="Medium"
 Margin="0,0,12,0"/>
    
    <ComboBox Width="150"
         SelectedValue="{Binding StatusFilter, Mode=TwoWay}"
    ToolTip="Filter by processing status">
      <ComboBox.Style>
        <Style TargetType="ComboBox">
     <Setter Property="Padding" Value="8,6"/>
  <Setter Property="BorderBrush" Value="#BDBDBD"/>
          <Setter Property="BorderThickness" Value="1"/>
       <Style.Triggers>
 <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="BorderBrush" Value="#2196F3"/>
 </Trigger>
          </Style.Triggers>
      </Style>
      </ComboBox.Style>
      <ComboBoxItem Content="All" Tag="{x:Null}" IsSelected="True"/>
      <ComboBoxItem Content="Pending" Tag="{x:Static models:ProcessingStatus.Pending}"/>
      <ComboBoxItem Content="Processing" Tag="{x:Static models:ProcessingStatus.Processing}"/>
      <ComboBoxItem Content="Completed" Tag="{x:Static models:ProcessingStatus.Completed}"/>
      <ComboBoxItem Content="Failed" Tag="{x:Static models:ProcessingStatus.Failed}"/>
      <ComboBoxItem Content="Unparsed" Tag="{x:Static models:ProcessingStatus.Unparsed}"/>
    </ComboBox>
  </StackPanel>

  <!-- Search Box -->
    <StackPanel Grid.Column="4" Orientation="Horizontal">
 <TextBlock Text="&#x1F50D;" 
   FontSize="16"
  VerticalAlignment="Center"
       Margin="0,0,8,0"/>
     <TextBox Width="250"
    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
           ToolTip="Search by show name, filename, or path">
<TextBox.Style>
       <Style TargetType="TextBox">
    <Setter Property="Padding" Value="8,6"/>
   <Setter Property="BorderBrush" Value="#BDBDBD"/>
       <Setter Property="BorderThickness" Value="1"/>
  <Style.Triggers>
   <Trigger Property="IsMouseOver" Value="True">
 <Setter Property="BorderBrush" Value="#2196F3"/>
         </Trigger>
 <Trigger Property="IsFocused" Value="True">
       <Setter Property="BorderBrush" Value="#2196F3"/>
    </Trigger>
  </Style.Triggers>
      </Style>
    </TextBox.Style>
   </TextBox>
</StackPanel>
   </Grid>
  </Border>

        <!-- Content Area with Filter Panel (Phase 6) -->
        <DockPanel Grid.Row="3">
      <!-- Phase 6: Advanced Filter Panel -->
   <controls:AdvancedFilterPanel DockPanel.Dock="Right"
   Width="350"
  DataContext="{Binding FilterViewModel}"/>
     
   <!-- Content Area: Card View, Compact View, or Grid View -->
    <Grid>
   <!-- Card View -->
      <ScrollViewer VerticalScrollBarVisibility="Auto"
      Visibility="{Binding IsCardViewSelected, Converter={StaticResource BoolToVisibilityConverter}}">
      <ItemsControl ItemsSource="{Binding Episodes}"
      Margin="16">
   <ItemsControl.ItemsPanel>
   <ItemsPanelTemplate>
         <StackPanel/>
     </ItemsPanelTemplate>
   </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
       <DataTemplate>
       <controls:FileEpisodeCard Margin="0,0,0,12"/>
        </DataTemplate>
     </ItemsControl.ItemTemplate>
            </ItemsControl>
  </ScrollViewer>

            <!-- Compact View (TODO: Phase 3) -->
    <ScrollViewer VerticalScrollBarVisibility="Auto"
    Visibility="{Binding IsCompactViewSelected, Converter={StaticResource BoolToVisibilityConverter}}">
     <ItemsControl ItemsSource="{Binding Episodes}"
      Margin="16">
   <ItemsControl.ItemsPanel>
   <ItemsPanelTemplate>
      <StackPanel/>
     </ItemsPanelTemplate>
   </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
       <DataTemplate>
       <controls:FileEpisodeCompactCard/>
        </DataTemplate>
 </ItemsControl.ItemTemplate>
   </ItemsControl>
  </ScrollViewer>

            <!-- Grid View (existing DataGrid) -->
  <DataGrid x:Name="EpisodesDataGrid"
              Visibility="{Binding IsGridViewSelected, Converter={StaticResource BoolToVisibilityConverter}}"
     ItemsSource="{Binding Episodes}"
     AutoGenerateColumns="False"
    IsReadOnly="True"
       SelectionMode="Single"
          CanUserSortColumns="True"
         CanUserResizeColumns="True"
       CanUserReorderColumns="True"
  GridLinesVisibility="Horizontal"
      HeadersVisibility="Column"
   AlternationCount="2"
      Margin="0,5,0,0">

            <i:Interaction.Behaviors>
                <behaviors:DataGridColumnWidthPersistence 
           GridKey="TvEpisodesGrid"
             WindowStateService="{Binding WindowStateService}" />
     </i:Interaction.Behaviors>

   <DataGrid.RowStyle>
   <Style TargetType="DataGridRow">
         <Style.Triggers>
      <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ProcessingStatus.Pending}">
          <Setter Property="Background" Value="{StaticResource PendingBrush}"/>
    </DataTrigger>
 <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ProcessingStatus.Processing}">
        <Setter Property="Background" Value="{StaticResource ProcessingBrush}"/>
  </DataTrigger>
    <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ProcessingStatus.Completed}">
     <Setter Property="Background" Value="{StaticResource CompletedBrush}"/>
</DataTrigger>
  <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ProcessingStatus.Failed}">
    <Setter Property="Background" Value="{StaticResource FailedBrush}"/>
        </DataTrigger>
  <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ProcessingStatus.Unparsed}">
        <Setter Property="Background" Value="{StaticResource UnparsedBrush}"/>
   <Setter Property="Foreground" Value="Gray"/>
  </DataTrigger>
       </Style.Triggers>
       </Style>
        </DataGrid.RowStyle>

   <DataGrid.ContextMenu>
     <ContextMenu>
        <MenuItem Header="View Details" 
 Command="{Binding ViewDetailsCommand}"
CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
      <MenuItem.Icon>
          <TextBlock Text="&#x1F4CB;" FontSize="14"/>
        </MenuItem.Icon>
      </MenuItem>
  <Separator/>
      <MenuItem Header="Open Source Folder" 
    Command="{Binding OpenSourceFolderCommand}"
       CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
   <MenuItem.Icon>
  <TextBlock Text="&#x1F4C1;" FontSize="14"/>
        </MenuItem.Icon>
 </MenuItem>
      <MenuItem Header="Open Destination Folder" 
     Command="{Binding OpenDestinationFolderCommand}"
    CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
     <MenuItem.Icon>
  <TextBlock Text="&#x1F4C2;" FontSize="14"/>
        </MenuItem.Icon>
      </MenuItem>
      <Separator/>
      <MenuItem Header="Copy Source Path" 
  Command="{Binding CopySourcePathCommand}"
    CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
  <MenuItem.Icon>
      <TextBlock Text="&#x1F4CB;" FontSize="14"/>
  </MenuItem.Icon>
 </MenuItem>
 <MenuItem Header="Copy Destination Path" 
    Command="{Binding CopyDestinationPathCommand}"
  CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
        <MenuItem.Icon>
  <TextBlock Text="&#x1F4CB;" FontSize="14"/>
   </MenuItem.Icon>
 </MenuItem>
      <Separator/>
      <MenuItem Header="Retry Failed" 
Command="{Binding RetryCommand}"
    CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
    <MenuItem.Icon>
       <TextBlock Text="&#x1F504;" FontSize="14"/>
     </MenuItem.Icon>
    </MenuItem>
  <Separator/>
 <MenuItem Header="Remove" 
  Command="{Binding RemoveSelectedCommand}"
         CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}">
 <MenuItem.Icon>
  <TextBlock Text="&#x1F5D1;" FontSize="14"/>
   </MenuItem.Icon>
 </MenuItem>
      <MenuItem Header="Remove All Failed" 
   Command="{Binding RemoveAllFailedCommand}">
  <MenuItem.Icon>
  <TextBlock Text="&#x26A0;&#xFE0F;" FontSize="14"/>
 </MenuItem.Icon>
 </MenuItem>
   <MenuItem Header="Remove All Completed" 
  Command="{Binding RemoveAllCompletedCommand}">
        <MenuItem.Icon>
     <TextBlock Text="&#x2705;" FontSize="14"/>
    </MenuItem.Icon>
   </MenuItem>
      <MenuItem Header="Clear All" 
Command="{Binding ClearAllCommand}">
     <MenuItem.Icon>
  <TextBlock Text="&#x1F5D1;" FontSize="14"/>
        </MenuItem.Icon>
      </MenuItem>
    <Separator/>
     <MenuItem Header="Select All"
  Command="{Binding SelectAllCommand}">
  <MenuItem.Icon>
        <TextBlock Text="&#x2611;&#xFE0F;" FontSize="14"/>
 </MenuItem.Icon>
 </MenuItem>
      </ContextMenu>
   </DataGrid.ContextMenu>

   <DataGrid.Columns>
    <!-- Show Name -->
      <DataGridTextColumn Header="Show" 
   Binding="{Binding ShowName}"
   Width="*"
         MinWidth="150"/>

     <!-- Season -->
 <DataGridTextColumn Header="Season" 
    Binding="{Binding SeasonNumber}"
  Width="60"/>

     <!-- Episode(s) -->
    <DataGridTextColumn Header="Episode(s)" 
     Binding="{Binding EpisodeNumbers}"
       Width="80"/>

  <!-- New Filename -->
<DataGridTextColumn Header="New Filename" 
      Binding="{Binding NewFileName}"
   Width="*"
       MinWidth="200"/>

    <!-- Status -->
       <DataGridTextColumn Header="Status" 
    Binding="{Binding StatusText}"
        Width="100"/>

    <!-- Source Path -->
      <DataGridTextColumn Header="Source Path" 
   Binding="{Binding SourcePath}"
    Width="*"
 MinWidth="250"/>

 <!-- Destination Path -->
   <DataGridTextColumn Header="Destination Path" 
 Binding="{Binding DestinationPath}"
       Width="*"
        MinWidth="250"/>

    <!-- Error Message -->
    <DataGridTextColumn Header="Error" 
         Binding="{Binding ErrorMessage}"
Width="*"
    MinWidth="200"/>
   </DataGrid.Columns>
   </DataGrid>
        </Grid>
</DockPanel>

   <!-- Status Bar -->
   <StatusBar Grid.Row="4" Style="{StaticResource ModernStatusBar}">
   <StatusBarItem>
       <TextBlock Text="{Binding StatusMessage}"/>
     </StatusBarItem>
   <StatusBarItem HorizontalAlignment="Right">
  <TextBlock Text="{Binding Episodes.Count, StringFormat='Episodes: {0}'}"/>
   </StatusBarItem>
 </StatusBar>
  </Grid>
</UserControl>
